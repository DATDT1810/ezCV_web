<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8" />
    <meta name="description" content="" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>ezCV - Tạo CV chuyên nghiệp trong tầm tay</title>
    <link rel="icon" href="img/core-img/favicon.ico" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/responsive.css" />
</head>

<body class="ali-bg">
    <!-- ##### Blog Area Start ##### -->
    <section class="blog-area">
        <div class="container-fluid">
            <div class="row">
                <div class="col-12 col-md-5">
                    <div class="cv-prev">
                        <div class="blog_thumbnail">
                            <img src="img/demos/demo-1.png" class="temp-img" alt="" />
                        </div>
                    </div>
                </div>

                <div class="col-12 col-md-7">
                    <div class="cv-download">
                        <div class="row align-items-center">
                            <div class="col-lg-6 col-md-12">
                                <p class="topnote">
                                    Điền tất cả các trường bắt buộc và nhấp vào "Tạo CV" để lưu
                                    dữ liệu của bạn.
                                </p>
                            </div>
                        </div>
                    </div>

                    <div class="container">
                        <!-- Form có ID rõ ràng -->
                        <form id="cvDataForm">
                            <div class="mt-150">
                                <h2>Thông tin cá nhân</h2>
                                <div class="block-container">
                                    <div class="row align-items-center">
                                        <div class="col-lg-2 col-md-4">
                                            <img src="img/test-img/1.jpg" class="d-block" alt="" />
                                        </div>
                                        <div class="col-lg-5 col-md-8 mt-s">
                                            <h6>Tải ảnh của bạn</h6>
                                            <p class="text-muted mb-0">
                                                Kích thước đề xuất: 300x300 (.jpg hoặc .png)
                                            </p>
                                        </div>
                                        <div class="col-lg-5 col-md-12 mt-s">
                                            <label for="avatar">Tải ảnh lên</label>

                                        </div>
                                    </div>

                                    <div class="mt-30">
                                        <div class="row">
                                            <div class="col-lg-6">
                                                <label>Tên đầy đủ:</label>
                                                <input type="text" name="full-name" class="form-control"
                                                    placeholder="Nhập tên đầy đủ của bạn" required />
                                            </div>

                                            <div class="col-lg-6">
                                                <label>Tiêu đề công việc:</label>
                                                <input type="text" name="job-title" class="form-control"
                                                    placeholder="Ex: Lập trình viên Web" />
                                            </div>

                                            <div class="col-lg-6">
                                                <label>Địa chỉ:</label>
                                                <input type="text" name="address" class="form-control"
                                                    placeholder="Nhập địa chỉ của bạn" required />
                                            </div>

                                            <div class="col-lg-6">
                                                <label>Email:</label>
                                                <input type="email" name="email" class="form-control"
                                                    placeholder="Nhập email của bạn" required />
                                            </div>
                                            <div class="col-lg-6">
                                                <label>Ngày tháng năm sinh:</label>
                                                <input type="date" name="birthday" class="form-control"
                                                    placeholder="Nhập email của bạn" />
                                            </div>

                                            <div class="col-lg-6">
                                                <label>Số điện thoại:</label>
                                                <input type="tel" name="phone" class="form-control"
                                                    placeholder="VD: 0901234567" pattern="^(0|\+84)(\d{9})$" required />
                                            </div>

                                            <div class="col-lg-12">
                                                <label>Giới thiệu bản thân (Bio):</label>
                                                <textarea name="comments" rows="4" class="form-control"
                                                    placeholder="Viết ngắn gọn về bản thân..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- HỌC VẤN -->
                            <div class="form-group add-social mt-s">
                                <h2>Học vấn</h2>
                                <div class="block-container">
                                    <div class="all-edus">
                                        <div class="new-edu">
                                            <label>Tên trường / Trung tâm:</label>
                                            <input type="text" class="form-control"
                                                placeholder="Ví dụ: Đại học Kinh tế TP.HCM" />
                                            <label>Ngành học:</label>
                                            <input type="text" class="form-control"
                                                placeholder="Ví dụ: Quản trị Kinh doanh" />
                                            <label>Thời gian học:</label>
                                            <input type="text" class="form-control" placeholder="Ví dụ: 2019 - 2023" />
                                        </div>
                                    </div>

                                    <!-- Nút thêm -->
                                    <div class="add-blk add-edu btn btn-info mt-50" id="add-edu">
                                        <i class="fa fa-plus"></i>
                                        <span>Thêm học vấn khác</span>
                                    </div>
                                </div>
                            </div>

                            <!-- KINH NGHIỆM LÀM VIỆC -->
                            <div class="form-group add-social mt-s">
                                <h2>Kinh nghiệm làm việc</h2>
                                <div class="block-container">
                                    <div class="all-exps">
                                        <div class="new-exp">
                                            <label>Tên công ty:</label>
                                            <input type="text" class="form-control" required
                                                placeholder="Ví dụ: Công ty TNHH ABC" />
                                            <label>Vị trí:</label>
                                            <input type="text" class="form-control" required
                                                placeholder="Ví dụ: Nhân viên kinh doanh" />
                                            <label>Thời gian làm việc:</label>
                                            <input type="text" class="form-control" placeholder="Ví dụ: 2022 - 2024"
                                                required />
                                        </div>
                                    </div>

                                    <!-- Nút thêm -->
                                    <div class="add-blk add-exp btn btn-info mt-50" id="add-exp">
                                        <i class="fa fa-plus"></i>
                                        <span>Thêm kinh nghiệm khác</span>
                                    </div>
                                </div>
                            </div>

                            <!-- KỸ NĂNG -->
                            <div class="form-group add-social mt-s">
                                <h2>Kỹ năng</h2>
                                <div class="block-container">
                                    <div class="all-skills">
                                        <div class="new-skills">
                                            <label>Kỹ năng:</label>
                                            <input type="text" name="skills[]" class="form-control"
                                                placeholder="VD: HTML, C#, Photoshop..." required />
                                            <label>Trình độ:</label>
                                            <input type="text" name="skills[]" class="form-control"
                                                placeholder="VD: Cơ bản, Trung bình, Thành thạo..." required />
                                        </div>
                                    </div>

                                    <!-- Nút thêm -->
                                    <div class="add-blk add-skills btn btn-info mt-50">
                                        <i class="fa fa-plus"></i>
                                        <span>Thêm kỹ năng khác</span>
                                    </div>
                                </div>
                            </div>

                            <!-- SỞ THÍCH -->
                            <div class="form-group add-social mt-s">
                                <h2>Sở thích</h2>
                                <div class="block-container">
                                    <div class="all-hoppies">
                                        <div class="new-hoppies">
                                            <label>Sở thích:</label>
                                            <input type="text" class="form-control"
                                                placeholder="Ví dụ: Đọc sách, Du lịch" />
                                        </div>
                                    </div>

                                    <!-- Nút thêm -->
                                    <div class="add-blk add-hoppies btn btn-info mt-50">
                                        <i class="fa fa-plus"></i>
                                        <span>Thêm sở thích khác</span>
                                    </div>
                                </div>
                            </div>

                            <hr class="mt-100" />
                            <input type="button" name="submit" value="Tạo CV" class="btn-sub" />
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ########## All JS ########## -->
    <!-- jQuery js -->
    <script src="js/jquery.min.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="js/plugins.js"></script>
    <!-- Parallax js -->
    <script src="js/dzsparallaxer.js"></script>
    <!-- Active js -->
    <script src="js/form-script.js"></script>
    <script src="js/script.js"></script>

    <!-- Firebase SDK (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

    <script>
        // ===============================
        // Firebase Config
        // ===============================
        const firebaseConfig = {
            apiKey: "AIzaSyBiG0G0uzpu4rKWyzVWWxM2y9iGGUn7e0",
            authDomain: "ezcv-60898.firebaseapp.com",
            projectId: "ezcv-60898",
            storageBucket: "ezcv-60898.appspot.com",
            messagingSenderId: "633226888127",
            appId: "1:633226888127:web:bcf0b63f51df7f1d57d70a",
            measurementId: "G-YJ62Z7GTSK",
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // ===============================
        // Upload Avatar to Firebase Storage
        // ===============================
        async function uploadAvatar(fileInput) {
            const file = fileInput?.files?.[0];
            if (!file) return "";

            try {
                const storageRef = storage.ref(`avatars/${Date.now()}_${file.name}`);
                await storageRef.put(file);
                return await storageRef.getDownloadURL();
            } catch (error) {
                console.error(" Lỗi upload ảnh:", error);
                alert("Không thể upload ảnh. Vui lòng thử lại!");
                return "";
            }
        }

        // ===============================
        // Thu thập dữ liệu học vấn, kinh nghiệm, kỹ năng, sở thích
        // ===============================
        function collectCVData() {
            const form = document.getElementById("cvDataForm");
            const formData = new FormData(form);

            const data = {
                fullName: formData.get("full-name") || "",
                jobTitle: formData.get("job-title") || "",
                address: formData.get("address") || "",
                email: formData.get("email") || "",
                phone: formData.get("phone") || "",
                birthday: formData.get("birthday") || "",
                organic: formData.get("comments") || "",
            };

            // 🔹 Học vấn
            data.education = [];
            document.querySelectorAll(".new-edu").forEach(edu => {
                const inputs = edu.querySelectorAll("input");
                data.education.push({
                    school: inputs[0]?.value || "",
                    subject: inputs[1]?.value || "",
                    degree: "Cử nhân",
                    fromMonth: "",
                    toMonth: inputs[2]?.value || "",
                });
            });

            // 🔹 Kinh nghiệm
            data.experience = [];
            document.querySelectorAll(".new-exp").forEach(exp => {
                const inputs = exp.querySelectorAll("input");
                data.experience.push({
                    company: inputs[0]?.value || "",
                    title: inputs[1]?.value || "",
                    description: "",
                    fromMonth: "",
                    toMonth: inputs[2]?.value || "",
                });
            });

            // 🔹 Kỹ năng
            data.skills = [];
            document.querySelectorAll(".new-skills").forEach(skill => {
                const inputs = skill.querySelectorAll("input");
                data.skills.push({
                    skillName: inputs[0]?.value || "",
                    level: inputs[1]?.value || "",
                });
            });

            // 🔹 Sở thích
            data.hobbies = [];
            document.querySelectorAll(".new-hoppies").forEach(h => {
                const inputs = h.querySelectorAll("input");
                data.hobbies.push({ hobbyName: inputs[0]?.value || "" });
            });

            return data;
        }

        // ===============================
        // Lưu dữ liệu vào Firestore
        // ===============================
        async function saveCVToFirestore(cvData) {
            try {
                await db.collection("user_cvs").add({
                    ...cvData,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                });
                alert(" CV của bạn đã được lưu thành công!");
            } catch (error) {
                console.error(" Lỗi lưu Firestore:", error);
                alert("Không thể lưu dữ liệu lên Firebase!");
            }
        }

        // ===============================
        // Submit form
        // ===============================
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("cvDataForm");
            const avatarInput = document.getElementById("avatar");
            const submitButton = document.querySelector(".btn-sub");

            // Nếu form chưa có input file thì thêm
            if (!avatarInput) {
                const label = document.querySelector('label[for="avatar"]');
                const input = document.createElement("input");
                input.type = "file";
                input.id = "avatar";
                input.accept = "image/*";
                label.parentNode.appendChild(input);
            }

            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                submitButton.disabled = true;
                submitButton.value = "Đang lưu...";

                //  Thu thập dữ liệu
                const data = collectCVData();

                //  Upload ảnh
                const avatarUrl = await uploadAvatar(document.getElementById("avatar"));
                if (avatarUrl) data.avatar = avatarUrl;

                // Lưu Firestore
                await saveCVToFirestore(data);

                submitButton.disabled = false;
                submitButton.value = "Tạo CV";
                form.reset();
            });
        });
    </script>


</body>

</html>